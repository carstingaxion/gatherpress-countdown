(()=>{"use strict";var e,t={99(){const e=window.wp.blocks,t=window.wp.i18n,s=window.wp.blockEditor,n=window.wp.components,o=window.wp.element,r=window.wp.data,a=window.wp.date,l=window.wp.coreData,i=window.ReactJSXRuntime,c={years:31557600,months:30.44*24*60*60,weeks:604800,days:86400,hours:3600,minutes:60,seconds:1},d=["years","months","weeks","days","hours","minutes","seconds"];function u(e,t){if(!e)return d.reduce((e,t)=>({...e,[t]:0}),{total:0});const s=(new Date).getTime(),n=new Date(e).getTime()-s,o=Math.abs(n);let r=Math.floor(o/1e3);const a={total:n};return d.forEach(e=>{const s=`show${e.charAt(0).toUpperCase()+e.slice(1)}`;t[s]?(a[e]=Math.floor(r/c[e]),r-=a[e]*c[e]):a[e]=0}),a}function h(e,s){const n={years:{singular:(0,t.__)("Year"),plural:(0,t.__)("Years")},months:{singular:(0,t.__)("Month"),plural:(0,t.__)("Months")},weeks:{singular:(0,t.__)("Week"),plural:(0,t.__)("Weeks")},days:{singular:(0,t.__)("Day"),plural:(0,t.__)("Days")},hours:{singular:(0,t.__)("Hour"),plural:(0,t.__)("Hours")},minutes:{singular:(0,t.__)("Minute"),plural:(0,t.__)("Minutes")},seconds:{singular:(0,t.__)("Second"),plural:(0,t.__)("Seconds")}};return n[e]?1===s?n[e].singular:n[e].plural:""}function g({message:e}){return(0,i.jsxs)("div",{className:"gatherpress-countdown-loading",children:[(0,i.jsx)(n.Spinner,{}),(0,i.jsx)("p",{children:e})]})}function p({message:e,action:t}){return(0,i.jsxs)("div",{className:"gatherpress-countdown-no-events",children:[(0,i.jsx)("p",{children:e}),t]})}function m({message:e}){return(0,i.jsx)("p",{className:"gatherpress-countdown-event-sync-note",children:e})}function w({emoji:e,message:t,variant:s=""}){return(0,i.jsxs)("div",{className:`gatherpress-countdown-event-indicator ${s}`,children:[(0,i.jsx)("span",{className:"gatherpress-countdown-event-badge",children:e}),(0,i.jsx)("span",{children:t})]})}const _=JSON.parse('{"UU":"gatherpress/countdown"}');(0,e.registerBlockType)(_.UU,{edit:function({attributes:e,setAttributes:c,clientId:_,context:x}){const{targetDateTime:v,gatherPressEventId:f,gatherPressTaxonomy:j,gatherPressTermId:y,mode:b,autoMode:T,eventMode:C,taxonomyMode:S,showLabels:N,showYears:P,showMonths:k,showWeeks:E,showDays:D,showHours:I,showMinutes:M,showSeconds:R}=e,O=(0,o.useMemo)(()=>({showYears:P,showMonths:k,showWeeks:E,showDays:D,showHours:I,showMinutes:M,showSeconds:R}),[P,k,E,D,I,M,R]),[L,B]=(0,o.useState)(u(v,O)),[,U]=(0,o.useState)(null),{updateBlockAttributes:A}=(0,r.useDispatch)("core/block-editor"),F=(0,a.getSettings)(),$=`${F.formats.date} ${F.formats.time}`,G=x?.postId,H=x?.postType,W="gatherpress_event"===H,Y=function(e,t,s){return(0,r.useSelect)(t=>{if(!s||!e)return null;const{getEntityRecord:n}=t(l.store),o=n("postType","gatherpress_event",e);return o?.meta?.gatherpress_datetime_start||null},[s,e])}(G,0,W),{events:q,isLoadingEvents:J}=function(e){return(0,r.useSelect)(t=>{const{getEntityRecords:s,isResolving:n}=t(l.store),o={per_page:100,status:"publish",order:"countup"===e?"desc":"asc",gatherpress_event_query:"countup"===e?"past":"upcoming"};return{events:s("postType","gatherpress_event",o)||[],isLoadingEvents:n("getEntityRecords",["postType","gatherpress_event",o])}},[e])}(C),{taxonomies:z,isLoadingTaxonomies:X}=(0,r.useSelect)(e=>{const{getTaxonomies:t,isResolving:s}=e(l.store),n={per_page:-1};return{taxonomies:(t(n)||[]).filter(e=>e.types&&e.types.includes("gatherpress_event")),isLoadingTaxonomies:s("getTaxonomies",[n])}},[]),{terms:K,isLoadingTerms:Q}=(V=j,(0,r.useSelect)(e=>{if(!V)return{terms:[],isLoadingTerms:!1};const{getEntityRecords:t,isResolving:s}=e(l.store),n={per_page:100};return{terms:t("taxonomy",V,n)||[],isLoadingTerms:s("getEntityRecords",["taxonomy",V,n])}},[V]));var V;const{nextEventFromTerm:Z,isLoadingNextEvent:ee}=function(e,t,s){return(0,r.useSelect)(n=>{if(!e||!t)return{nextEventFromTerm:null,isLoadingNextEvent:!1};const{getEntityRecords:o,isResolving:r}=n(l.store),a="countup"===s?"past":"upcoming",i="countup"===s?"desc":"asc",c={per_page:1,status:"publish",[e]:t,gatherpress_event_query:a,order:i},d=o("postType","gatherpress_event",c)||[];return{nextEventFromTerm:d.length>0?d[0]:null,isLoadingNextEvent:r("getEntityRecords",["postType","gatherpress_event",c])}},[e,t,s])}(j,y,S),te=(se=f,(0,r.useSelect)(e=>{if(!se)return null;const{getEntityRecord:t}=e(l.store);return t("postType","gatherpress_event",se)},[se]));var se;const ne=v&&!f&&!y&&!W,oe=f>0,re=y>0,ae=W&&Y&&!f&&!y&&v===Y;(0,o.useEffect)(()=>{W&&Y&&(v||f||y||c({targetDateTime:Y}))},[c,W,Y,v,f,y]),(0,o.useEffect)(()=>{const e=Z?.meta?.gatherpress_datetime_start;e&&e!==v&&c({targetDateTime:e})},[c,Z,v]),(0,o.useEffect)(()=>{const e=te?.meta?.gatherpress_datetime_start;e&&e!==v&&c({targetDateTime:e})},[c,v,te]),(0,o.useEffect)(()=>{if(!v)return;const e=setInterval(()=>{B(u(v,O))},1e3);return()=>clearInterval(e)},[v,O]),(0,o.useEffect)(()=>{if(v&&T&&ne){let e="countdown";L.total<0&&(e="countup"),e!==b&&c({mode:e})}},[v,L.total,b,T,ne,c]),(0,o.useEffect)(()=>{if(v&&A){const e=(0,a.dateI18n)($,v);let s="";s="countdown"===b?(0,t.sprintf)(/* translators: %s: target date */ /* translators: %s: target date */
(0,t.__)("Countdown to %s","gatherpress-countdown"),e):(0,t.sprintf)(/* translators: %s: start date */ /* translators: %s: start date */
(0,t.__)("Count up from %s","gatherpress-countdown"),e),A(_,{metadata:{name:s}})}},[v,b,_,A,$]);const le=(0,s.useBlockProps)({className:"gatherpress-countdown-wrapper"}),ie=d.filter(e=>{const t=`show${e.charAt(0).toUpperCase()+e.slice(1)}`;return O[t]}).map(e=>({type:e,value:L[e],label:h(e,L[e])})),ce=q.map(e=>({value:e.id,label:e.title.rendered})),de=K.map(e=>({value:e.id,label:e.name})),ue=e=>{if(!e)return void c({gatherPressEventId:0,gatherPressTaxonomy:"",gatherPressTermId:0});const t=parseInt(e,10);c({gatherPressEventId:t,gatherPressTaxonomy:"",gatherPressTermId:0})},he=e=>{if(!e)return void c({gatherPressTermId:0,gatherPressEventId:0});const t=parseInt(e,10);c({gatherPressTermId:t,gatherPressEventId:0})},ge=e=>{if(e){const t=new Date(e);if(!isNaN(t.getTime())){const e=t.toISOString();c({targetDateTime:e,gatherPressEventId:0,gatherPressTaxonomy:"",gatherPressTermId:0}),U(null)}}},pe=()=>{if(J)return(0,i.jsx)(g,{message:(0,t.__)("Loading eventsâ€¦","gatherpress-countdown")});if(0===q.length)return(0,i.jsx)(p,{message:(0,t.__)("No GatherPress events found.","gatherpress-countdown")});let e="";return f>0&&te&&(e=(0,t.sprintf)(/* translators: %s: event title */ /* translators: %s: event title */
(0,t.__)("Synced with event: %s","gatherpress-countdown"),te.title.rendered)),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.RadioControl,{label:(0,t.__)("Display mode","gatherpress-countdown"),selected:C,options:[{label:(0,t.__)("Countdown (time until event)","gatherpress-countdown"),value:"countdown"},{label:(0,t.__)("Count up (time since event)","gatherpress-countdown"),value:"countup"}],onChange:e=>c({eventMode:e,mode:e})}),(0,i.jsx)(n.ComboboxControl,{label:(0,t.__)("Select an event","gatherpress-countdown"),value:f||null,onChange:ue,options:ce,allowReset:!0,help:e}),f>0&&"countdown"===C&&(0,i.jsx)(n.ToggleControl,{label:(0,t.__)("Automatic mode switching","gatherpress-countdown"),checked:T,onChange:e=>c({autoMode:e}),help:(0,t.__)("Automatically switch from countdown to count-up when the event date is reached.","gatherpress-countdown")})]})},me=()=>{if(Q)return(0,i.jsx)(g,{message:(0,t.__)("Loading termsâ€¦","gatherpress-countdown")});if(0===K.length)return(0,i.jsx)(p,{message:(0,t.__)("No terms found.","gatherpress-countdown"),action:(0,i.jsx)(n.Button,{isSecondary:!0,isSmall:!0,onClick:()=>c({gatherPressTaxonomy:""}),children:(0,t.__)("Back to taxonomies","gatherpress-countdown")})});let e="";e="countdown"===S?(0,t.__)("Using next event:","gatherpress-countdown"):(0,t.__)("Using last event:","gatherpress-countdown");let s="";y>0&&Z&&(s=(0,t.sprintf)(/* translators: 1: mode message, 2: event title */ /* translators: 1: mode message, 2: event title */
(0,t.__)("%1$s %2$s","gatherpress-countdown"),e,Z.title.rendered));const o=z.find(e=>e.slug===j);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"gatherpress-countdown-taxonomy-header",children:[(0,i.jsx)(n.Button,{isSmall:!0,icon:"arrow-left-alt2",onClick:()=>{c({gatherPressTaxonomy:"",gatherPressTermId:0})},label:(0,t.__)("Back","gatherpress-countdown")}),(0,i.jsx)("span",{className:"gatherpress-countdown-taxonomy-name",children:o?o.name:""})]}),(0,i.jsx)(n.RadioControl,{label:(0,t.__)("Display mode","gatherpress-countdown"),selected:S,options:[{label:(0,t.__)("Countdown (time until event)","gatherpress-countdown"),value:"countdown"},{label:(0,t.__)("Count up (time since event)","gatherpress-countdown"),value:"countup"}],onChange:e=>c({taxonomyMode:e,mode:e})}),(0,i.jsx)(n.ComboboxControl,{label:(0,t.__)("Select a term","gatherpress-countdown"),value:y||null,onChange:he,options:de,allowReset:!0}),y>0&&(0,i.jsxs)(i.Fragment,{children:[ee?(0,i.jsx)(g,{message:(0,t.__)("Finding next eventâ€¦","gatherpress-countdown")}):null,!ee&&Z?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m,{message:s}),"countdown"===S&&(0,i.jsx)(n.ToggleControl,{label:(0,t.__)("Automatic mode switching","gatherpress-countdown"),checked:T,onChange:e=>c({autoMode:e}),help:(0,t.__)("Automatically switch from countdown to count-up when the event date is reached.","gatherpress-countdown")})]}):null,ee||Z?null:(0,i.jsx)(n.Notice,{status:"warning",isDismissible:!1,children:(0,i.jsx)("p",{children:"countdown"===S?(0,t.__)("No upcoming events found in this term.","gatherpress-countdown"):(0,t.__)("No past events found in this term.","gatherpress-countdown")})})]})]})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.BlockControls,{children:(0,i.jsxs)(n.ToolbarGroup,{children:[(0,i.jsx)(n.Dropdown,{contentClassName:"gatherpress-countdown-datetime-popover",position:"bottom center",renderToggle:({isOpen:e,onToggle:s})=>(0,i.jsx)(n.ToolbarButton,{icon:"calendar-alt",label:(0,t.__)("Select date and time","gatherpress-countdown"),onClick:()=>{U(e?null:"datetime"),s()},"aria-expanded":e,isPressed:ne}),renderContent:()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.DateTimePicker,{currentDate:v||null,onChange:ge,is12Hour:!1}),v&&ne&&(0,i.jsx)("div",{style:{padding:"16px",borderTop:"1px solid #ddd"},children:(0,i.jsx)(n.ToggleControl,{label:(0,t.__)("Automatic mode switching","gatherpress-countdown"),checked:T,onChange:e=>c({autoMode:e}),help:(0,t.__)("Automatically switch from countdown to count-up when the target date is reached.","gatherpress-countdown")})})]})}),(0,i.jsx)(n.Dropdown,{contentClassName:"gatherpress-countdown-gatherpress-popover",position:"bottom center",renderToggle:({isOpen:e,onToggle:s})=>(0,i.jsx)(n.ToolbarButton,{icon:"nametag",label:(0,t.__)("Select GatherPress event","gatherpress-countdown"),onClick:()=>{U(e?null:"event"),s()},"aria-expanded":e,isPressed:oe}),renderContent:()=>(0,i.jsx)("div",{className:"gatherpress-countdown-gatherpress-selector",children:pe()})}),(0,i.jsx)(n.Dropdown,{contentClassName:"gatherpress-countdown-taxonomy-popover",position:"bottom center",renderToggle:({isOpen:e,onToggle:s})=>(0,i.jsx)(n.ToolbarButton,{icon:"tag",label:(0,t.__)("Select from GatherPress taxonomy","gatherpress-countdown"),onClick:()=>{U(e?null:"taxonomy"),s()},"aria-expanded":e,isPressed:re}),renderContent:()=>(0,i.jsx)("div",{className:"gatherpress-countdown-taxonomy-selector",children:X?(0,i.jsx)(g,{message:(0,t.__)("Loading taxonomiesâ€¦","gatherpress-countdown")}):0===z.length?(0,i.jsx)(p,{message:(0,t.__)("No taxonomies found for GatherPress events.","gatherpress-countdown")}):j?me():(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"gatherpress-countdown-taxonomy-label",children:(0,t.__)("Select an event taxonomy:","gatherpress-countdown")}),(0,i.jsx)(n.MenuGroup,{children:z.map(e=>(0,i.jsx)(n.MenuItem,{onClick:()=>c({gatherPressTaxonomy:e.slug,gatherPressTermId:0,gatherPressEventId:0}),children:e.name},e.slug))})]})})})]})}),(0,i.jsxs)(s.InspectorControls,{children:[(0,i.jsx)(n.PanelBody,{title:(0,t.__)("Display Settings","gatherpress-countdown"),children:(0,i.jsx)(n.ToggleControl,{label:(0,t.__)("Show labels","gatherpress-countdown"),checked:N,onChange:e=>c({showLabels:e}),help:(0,t.__)("Display labels for time segments.","gatherpress-countdown")})}),(0,i.jsxs)(n.PanelBody,{title:(0,t.__)("Time Segments","gatherpress-countdown"),initialOpen:!1,children:[d.map(s=>{const o=`show${s.charAt(0).toUpperCase()+s.slice(1)}`,r=s.charAt(0).toUpperCase()+s.slice(1);return(0,i.jsx)(n.ToggleControl,{label:(0,t.sprintf)(/* translators: %s: time segment name */ /* translators: %s: time segment name */
(0,t.__)("Show %s","gatherpress-countdown"),r),checked:e[o],onChange:e=>c({[o]:e})},s)}),(0,i.jsxs)(n.Notice,{status:"info",isDismissible:!1,className:"gatherpress-countdown-info-notice",children:[(0,i.jsx)("p",{children:(0,t.__)('Time segments cascade from largest to smallest. For example, a 40-day countdown with "months" and "days" selected displays "1 month, 10 days". Deselecting "months" updates it to "40 days".')}),(0,i.jsx)("p",{children:(0,t.__)("On the frontend, segments automatically hide when they reach zero and all larger segments are already hidden.")})]})]})]}),(0,i.jsxs)("div",{...le,children:[ae&&(0,i.jsx)(w,{emoji:"ðŸ“…",message:(0,t.__)("Using event date from context","gatherpress-countdown"),variant:"gatherpress-countdown-context-indicator"}),oe&&te&&(0,i.jsx)(w,{emoji:"ðŸŽŸï¸",message:(0,t.sprintf)(/* translators: %s: event title */ /* translators: %s: event title */
(0,t.__)("Synced with event: %s","gatherpress-countdown"),te.title.rendered)}),re&&Z&&(0,i.jsx)(w,{emoji:"ðŸ·ï¸",message:(0,t.sprintf)(/* translators: 1: mode message, 2: event title */ /* translators: 1: mode message, 2: event title */
(0,t.__)("%1$s %2$s","gatherpress-countdown"),"countdown"===S?(0,t.__)("Using next event:","gatherpress-countdown"):(0,t.__)("Using last event:","gatherpress-countdown"),Z.title.rendered)}),v?null:(0,i.jsx)("div",{className:"gatherpress-countdown__placeholder",children:(0,i.jsx)("p",{children:(0,t.__)("Select a date and time using the toolbar buttons above.","gatherpress-countdown")})}),v&&0===ie.length?(0,i.jsx)("div",{className:"gatherpress-countdown__placeholder",children:(0,i.jsx)("p",{children:(0,t.__)("Please select at least one time segment to display.","gatherpress-countdown")})}):null,v&&ie.length>0?(0,i.jsx)("div",{className:"gatherpress-countdown","data-mode":b,children:(0,i.jsx)("div",{className:"gatherpress-countdown__display",children:ie.map((e,t)=>{return(0,i.jsxs)("div",{className:"gatherpress-countdown__segment",children:[(0,i.jsx)("span",{className:"gatherpress-countdown__number",children:(s=e.value,s.toString().padStart(2,"0"))}),N&&(0,i.jsx)("span",{className:"gatherpress-countdown__label",children:e.label})]},t);var s})})}):null]})]})}})}},s={};function n(e){var o=s[e];if(void 0!==o)return o.exports;var r=s[e]={exports:{}};return t[e](r,r.exports,n),r.exports}n.m=t,e=[],n.O=(t,s,o,r)=>{if(!s){var a=1/0;for(d=0;d<e.length;d++){for(var[s,o,r]=e[d],l=!0,i=0;i<s.length;i++)(!1&r||a>=r)&&Object.keys(n.O).every(e=>n.O[e](s[i]))?s.splice(i--,1):(l=!1,r<a&&(a=r));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,o,r]},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};n.O.j=t=>0===e[t];var t=(t,s)=>{var o,r,[a,l,i]=s,c=0;if(a.some(t=>0!==e[t])){for(o in l)n.o(l,o)&&(n.m[o]=l[o]);if(i)var d=i(n)}for(t&&t(s);c<a.length;c++)r=a[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},s=globalThis.webpackChunkgatherpress_countdown=globalThis.webpackChunkgatherpress_countdown||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var o=n.O(void 0,[350],()=>n(99));o=n.O(o)})();